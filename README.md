# Prometheus OpenVPN exporter

This repository provides code for a simple Prometheus metrics exporter
for [OpenVPN](https://openvpn.net/). Right now it can parse files
generated by OpenVPN's `--status`, having one of the following formats:

* Client statistics,
* Server statistics with `--status-version 2` (comma delimited),
* Server statistics with `--status-version 3` (tab delimited).

## Usage

As it is not uncommon to run multiple instances of OpenVPN on a single
system (e.g., multiple servers, multiple clients or a mixture of both),
this exporter can be configured to scrape and export the status of
multiple status files, using the `-openvpn.status_paths` command line
flag. Paths need to be comma separated and can optionally be prefixed
with an instance name (i.e. a friendly name) followed by a separating
colon. Metrics for all status files are exported over TCP port 9176.

## Command line flags

* `-openvpn.status_paths`  
    Comma-separated list of paths at which OpenVPN places its status
    files. Optionally prefixed with an instance name followed by a
    colon.  
    (default "some-client:examples/client.status,examples/server2.status,instance-three:examples/server3.status")
* `-web.listen-address`
    Address to listen on for web interface and telemetry.  
    (default ":9176")
* `-web.telemetry-path`
    Path under which to expose metrics.  
    (default "/metrics")

## Client statistics

For clients status files, the exporter generates metrics that may look
like this:

```
openvpn_client_auth_read_bytes_total{status_path="...",instance_name="..."} 3.08854782e+08
openvpn_client_post_compress_bytes_total{status_path="...",instance_name="..."} 4.5446864e+07
openvpn_client_post_decompress_bytes_total{status_path="...",instance_name="..."} 2.16965355e+08
openvpn_client_pre_compress_bytes_total{status_path="...",instance_name="..."} 4.538819e+07
openvpn_client_pre_decompress_bytes_total{status_path="...",instance_name="..."} 1.62596168e+08
openvpn_client_tcp_udp_read_bytes_total{status_path="...",instance_name="..."} 2.92806201e+08
openvpn_client_tcp_udp_write_bytes_total{status_path="...",instance_name="..."} 1.97558969e+08
openvpn_client_tun_tap_read_bytes_total{status_path="...",instance_name="..."} 1.53789941e+08
openvpn_client_tun_tap_write_bytes_total{status_path="...",instance_name="..."} 3.08764078e+08
openvpn_status_update_time_seconds{status_path="...",instance_name="..."} 1.490092749e+09
openvpn_up{status_path="...",instance_name="..."} 1
```

## Server statistics

For server status files (both version 2 and 3), the exporter generates
metrics that may look like this:

```
openvpn_server_client_received_bytes_total{common_name="...",connection_time="...",real_address="...",status_path="...",instance_name="...",username="...",virtual_address="..."} 139583
openvpn_server_client_sent_bytes_total{common_name="...",connection_time="...",real_address="...",status_path="...",instance_name="...",username="...",virtual_address="..."} 710764
openvpn_server_route_last_reference_time_seconds{common_name="...",real_address="...",status_path="...",instance_name="...",virtual_address="..."} 1.493018841e+09
openvpn_status_update_time_seconds{status_path="...",instance_name="..."} 1.490089154e+09
openvpn_up{status_path="...",instance_name="..."} 1
```
